{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the Definition Detective application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "username": {
          "type": "string",
          "description": "The username chosen by the user.",
          "format": "string"
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was created.",
          "format": "date-time"
        },
        "lastLogin": {
          "type": "string",
          "description": "The user's last login.",
          "format": "date-time"
        },
        "totalScore": {
          "type": "number",
          "description": "The user's total accumulated score."
        },
        "highestLevel": {
          "type": "number",
          "description": "The highest level the user has reached."
        },
        "rank": {
          "type": "string",
          "description": "The user's current rank based on their score."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "createdAt",
        "totalScore",
        "highestLevel",
        "rank"
      ]
    },
    "GameSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameSession",
      "type": "object",
      "description": "Represents a single game session for a user, storing progress and score.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the game session."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N GameSession)"
        },
        "startTime": {
          "type": "string",
          "description": "Timestamp indicating the start of the game session.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "Timestamp indicating the end of the game session.",
          "format": "date-time"
        },
        "score": {
          "type": "number",
          "description": "The user's score for this game session."
        },
        "level": {
          "type": "number",
          "description": "The level the user reached in this game session."
        },
        "difficulty": {
          "type": "string",
          "description": "The game difficulty."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "startTime",
        "score",
        "level",
        "difficulty"
      ]
    },
    "LeaderboardEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaderboardEntry",
      "type": "object",
      "description": "Represents a single entry on the global leaderboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leaderboard entry."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N LeaderboardEntry)"
        },
        "score": {
          "type": "number",
          "description": "The user's score for the leaderboard entry."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the leaderboard entry was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "score",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data. Accessible only to the user and admins.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile."
            }
          ]
        }
      },
      {
        "path": "/userProfiles/{userProfileId}/gameSessions/{gameSessionId}",
        "definition": {
          "entityName": "GameSession",
          "schema": {
            "$ref": "#/backend/entities/GameSession"
          },
          "description": "Stores game session data for a specific user. Accessible only to the user and admins.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile."
            },
            {
              "name": "gameSessionId",
              "description": "The unique identifier for the game session."
            }
          ]
        }
      },
      {
        "path": "/leaderboardEntries/{leaderboardEntryId}",
        "definition": {
          "entityName": "LeaderboardEntry",
          "schema": {
            "$ref": "#/backend/entities/LeaderboardEntry"
          },
          "description": "Stores leaderboard entries. Globally readable but writeable only by authenticated users.",
          "params": [
            {
              "name": "leaderboardEntryId",
              "description": "The unique identifier for the leaderboard entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to prioritize security, scalability, and debuggability, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs.  It leverages Structural Segregation, Access Modeling, and Data Clarity and Predictability.\n\n*   **Authorization Independence**: Achieved through path-based ownership for `userProfiles` and `gameSessions`, ensuring that authorization rules can be written without relying on `get()` calls to parent documents. Leaderboard entries also use path based ownership.\n*   **Structural Segregation**: Documents with different access requirements are stored in separate collections.\n*   **Access Modeling**: Path-based ownership (`/users/{userId}/gameSessions/{gameSessionId}`) for user-owned data ensures secure and efficient access control. The `/leaderboardEntries` collection is globally readable but writeable only by authenticated users.\n*   **QAPs**: Segregation into `userProfiles`, `gameSessions`, and `leaderboardEntries` collections supports secure `list` operations.  The path-based ownership prevents unauthorized listing of game sessions.\n*   **Invariants**: The structure supports ownership integrity through path-based ownership. Timestamps (createdAt, startTime, endTime, timestamp) are easily enforced. No denormalization is needed for this specific structure."
  }
}